{"cells":[{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true,"base_uri":"https://localhost:8080/"},"id":"Q4bEq6K9LsdE"},"outputs":[{"name":"stdout","output_type":"stream","text":["Error: Could not import CredibilityVerificationSystem.\n","Please ensure 'credibility_system.py' exists and is in the correct path.\n","Current sys.path: ['/content', '/env/python', '/usr/lib/python311.zip', '/usr/lib/python3.11', '/usr/lib/python3.11/lib-dynload', '', '/usr/local/lib/python3.11/dist-packages', '/usr/lib/python3/dist-packages', '/usr/local/lib/python3.11/dist-packages/IPython/extensions', '/usr/local/lib/python3.11/dist-packages/setuptools/_vendor', '/root/.ipython']\n","CredibilityVerificationSystem module not found. Flask app will start, but /api/verify will not work.\n","Flask app created and CORS enabled.\n","Starting Flask development server...\n"," * Serving Flask app '__main__'\n"," * Debug mode: on\n"]},{"name":"stderr","output_type":"stream","text":["INFO:werkzeug:\u001b[31m\u001b[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.\u001b[0m\n"," * Running on all addresses (0.0.0.0)\n"," * Running on http://127.0.0.1:5000\n"," * Running on http://172.28.0.12:5000\n","INFO:werkzeug:\u001b[33mPress CTRL+C to quit\u001b[0m\n","INFO:werkzeug: * Restarting with stat\n"]}],"source":["# Import necessary libraries\n","from flask import Flask, request, jsonify\n","# Install flask_cors if not already installed\n","try:\n","    from flask_cors import CORS # To handle Cross-Origin Resource Sharing\n","except ImportError:\n","    print(\"flask_cors not found. Installing...\")\n","    !pip install flask_cors\n","    from flask_cors import CORS\n","    print(\"flask_cors installed successfully.\")\n","\n","import sys\n","import os\n","import traceback # To help with debugging errors\n","\n","# --- Configuration Import ---\n","# Add the directory containing 'credibility_system.py' to the Python path\n","# Adjust this path if your file structure is different\n","# Assumes 'credibility_system.py' is in the same directory as 'app.py'\n","# If it's elsewhere, provide the correct path.\n","# Example: sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), '..', 'path_to_your_module')))\n","\n","# Initialize credibility_checker to None, so we can check if it was successfully imported\n","credibility_checker = None\n","\n","try:\n","    # Assuming your CredibilityVerificationSystem class is in a file named 'credibility_system.py'\n","    # in the same directory as this 'app.py' file.\n","    from credibility_system import CredibilityVerificationSystem\n","    print(\"Successfully imported CredibilityVerificationSystem.\")\n","    # --- Instantiate the System ---\n","    # Load models only once when the server starts\n","    # This can take time, so the server might be slow to start initially.\n","    print(\"Initializing CredibilityVerificationSystem... (This might take a moment)\")\n","    credibility_checker = CredibilityVerificationSystem()\n","    print(\"CredibilityVerificationSystem initialized.\")\n","\n","except ImportError:\n","    print(\"Error: Could not import CredibilityVerificationSystem.\")\n","    print(\"Please ensure 'credibility_system.py' exists and is in the correct path.\")\n","    print(f\"Current sys.path: {sys.path}\")\n","    # Removed sys.exit() to avoid stopping the notebook execution\n","    # The credibility_checker will remain None, and the API endpoint\n","    # will need to handle this case.\n","    print(\"CredibilityVerificationSystem module not found. Flask app will start, but /api/verify will not work.\")\n","except Exception as e:\n","    print(f\"Error initializing CredibilityVerificationSystem: {e}\")\n","    traceback.print_exc() # Print detailed error traceback\n","    # Removed sys.exit()\n","    print(\"Failed to initialize credibility system. Flask app will start, but /api/verify will not work.\")\n","\n","\n","# --- Flask App Initialization ---\n","app = Flask(__name__)\n","# IMPORTANT: Enable CORS to allow requests from your HTML file (frontend)\n","# For development, allow all origins ('*'). For production, restrict this\n","# to the actual domain where your frontend is hosted.\n","CORS(app)\n","print(\"Flask app created and CORS enabled.\")\n","\n","# --- API Route Definition ---\n","@app.route('/api/verify', methods=['POST'])\n","def verify_endpoint():\n","    \"\"\"\n","    API endpoint to receive input data and return credibility analysis.\n","    Expects a JSON payload with the key 'input_data'.\n","    \"\"\"\n","    print(\"\\nReceived request on /api/verify\")\n","\n","    # Check if the credibility system was initialized successfully\n","    if credibility_checker is None:\n","        print(\"Error: Credibility verification system not initialized.\")\n","        return jsonify({\"error\": \"Credibility verification system is not available.\"}), 503 # Service Unavailable\n","\n","\n","    # 1. Get data from the request\n","    if not request.is_json:\n","        print(\"Error: Request is not JSON\")\n","        return jsonify({\"error\": \"Request must be JSON\"}), 400 # Bad Request\n","\n","    data = request.get_json()\n","    input_data = data.get('input_data', None)\n","\n","    if not input_data or not isinstance(input_data, str) or not input_data.strip():\n","        print(\"Error: 'input_data' is missing or invalid\")\n","        return jsonify({\"error\": \"'input_data' field is required and must be a non-empty string\"}), 400\n","\n","    print(f\"Processing input: {input_data[:100]}...\") # Log received data (truncated)\n","\n","    # 2. Call the credibility verification system\n","    try:\n","        # Use the pre-initialized checker instance\n","        results = credibility_checker.verify_information(input_data)\n","        print(\"Verification successful.\")\n","        # Check if the verification itself returned an error structure\n","        if isinstance(results, dict) and 'error' in results:\n","             print(f\"Verification returned an error: {results['error']}\")\n","             # Return the specific error from the verification logic\n","             # Use 400 (Bad Request) or potentially 500 (Internal Server Error)\n","             # depending on the nature of the error. 400 is often suitable if\n","             # the input caused the issue (e.g., invalid URL, empty text after processing).\n","             return jsonify(results), 400\n","\n","        # 3. Return the results as JSON\n","        print(f\"Returning report with score: {results.get('scoreCredibilite', 'N/A')}\")\n","        return jsonify(results), 200 # OK\n","\n","    except Exception as e:\n","        # Catch any unexpected errors during verification\n","        print(f\"Error during verification process: {e}\")\n","        traceback.print_exc() # Log the full error traceback for debugging\n","        # Return a generic server error message\n","        return jsonify({\"error\": \"An internal server error occurred during analysis.\"}), 500 # Internal Server Error\n","\n","\n","# --- Run the App (for development) ---\n","if __name__ == '__main__':\n","    # Runs the Flask development server.\n","    # host='0.0.0.0' makes it accessible on your network (useful for testing from other devices)\n","    # debug=True provides automatic reloading and more detailed error pages (DO NOT use in production)\n","    print(\"Starting Flask development server...\")\n","    # Flask's development server might restart multiple times when debug=True,\n","    # leading to re-execution of the code cell. This is normal behavior.\n","    app.run(host='0.0.0.0', port=5000, debug=True)"]}],"metadata":{"colab":{"name":"","provenance":[{"file_id":"1H6oPi2o3xKgNC1ZYv5rDnekxNJ-bYkHC","timestamp":1745620655445}],"version":""},"kernelspec":{"display_name":"Python 3","name":"python3"}},"nbformat":4,"nbformat_minor":0}